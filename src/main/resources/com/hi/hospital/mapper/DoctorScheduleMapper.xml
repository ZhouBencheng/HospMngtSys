<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hi.hospital.mapper.DoctorScheduleMapper">

    <resultMap id="docMap" type="com.hi.hospital.entity.DoctorSchedule">
        <id column="schedule_id" property="scheduleId" />
        <result column="doctor_id" property="doctorId" />
        <result column="date" property="date" />
        <result column="shift_time" property="shiftTime" />
        <result column="is_available" property="isAvailable" />
        <result column="visit_count" property="visitCount" />
        <result column="remarks" property="remarks" />
        <association property="doctors" javaType="com.hi.hospital.entity.Doctors">
            <result column="name" property="name"></result>
        </association>
        <association property="departments" javaType="com.hi.hospital.entity.Departments">
            <result column="department_name" property="departmentsName"></result>
        </association>
    </resultMap>

    <select id="selectAll" resultMap="docMap">
        SELECT
            schedule_id,
            ds.doctor_id,
            date,
            shift_time,
            is_available,
            visit_count,
            remarks,
            department_name,
            name
        FROM
            doctor_schedule ds,
            doctors doc,
            departments dep
        WHERE
            ds.department_id = dep.department_id
          AND ds.doctor_id = doc.doctor_id

        <if test="date!=null and date!=''">
            AND ds.date = #{date}
        </if>

        <if test="shiftTime!=null and shiftTime!=''">
            AND ds.shift_time = #{shiftTime}
        </if>

        <if test="deptId!=null and deptId!=''">
            AND ds.department_id = #{deptId}
        </if>

    </select>
</mapper>